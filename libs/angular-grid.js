/*
    angularGrid.js v 0.4.0
    Author: Sudhanshu Yadav
    Copyright (c) 2015 Sudhanshu Yadav - ignitersworld.com , released under the MIT license.
    Demo on: http://ignitersworld.com/lab/angulargrid/demo1.html
    Documentation and download on https://github.com/s-yadav/angulargrid 
*/

!function(n,t,i){"use strict";function o(n){return n.complete&&("undefined"==typeof n.naturalWidth||0!==n.naturalWidth)}function a(n){return Array.prototype.slice.call(n)}var r={gridWidth:300,gutterSize:10,gridNo:"auto",direction:"ltor",refreshOnImgLoad:!0,cssGrid:!1},e=n.element,d={visibility:"hidden",opacity:0,top:0,left:0,width:""},s=function(){var n=e(t);return function(t){return n[0]=t,n}}();e(document.head).append("<style>.ag-no-transition{-webkit-transition: none !important;transition: none !important;} .angular-grid{position : relative;} .angular-grid > *{opacity : 0} .angular-grid > .angular-grid-item{opacity : 1}</style>"),n.module("angularGrid",[]).directive("angularGrid",["$timeout","$window","$q","angularGridInstance",function(t,u,c,l){return{restrict:"A",scope:{model:"=angularGrid",gridWidth:"=",gutterSize:"=",refreshOnImgLoad:"=",direction:"=",cssGrid:"=",options:"=angularGridOptions"},link:function(f,g,h){function p(){M={},Object.keys(r).forEach(function(n){f[n]!=i&&(M[n]=f[n])}),M=n.extend({},r,M,f.options),M.cssGrid&&(M.gutterSize=0)}function m(){var n,t=S.offsetWidth;if(M.cssGrid){n=e(G[0]).clone(),n.css(d).addClass("ag-no-transition"),g.append(n);var i=n[0].offsetWidth;return n.remove(),{no:Math.floor((t+12)/i),width:i}}var o="auto"==M.gridNo?M.gridWidth:Math.floor(t/M.gridNo)-M.gutterSize,a="auto"==M.gridNo?Math.floor(t/(o+M.gutterSize)):M.gridNo,r=t%(o+M.gutterSize)+M.gutterSize;return o+=Math.floor(r/a),{no:a,width:o}}function v(t,i){var r=i.beforeLoad||n.noop,e=i.onLoad||n.noop,d=i.isLoaded||n.noop,s=i.onFullLoad||n.noop,u=i.ignoreCheck||n.noop,l=t.find("img"),f=[];a(l).forEach(function(n){r(n),o(n)||u(n)?d(n):f.push(c(function(t,i){n.onload=function(){e(n),t()},n.onerror=i}))}),f.length?c.all(f).then(s,s):setTimeout(function(){s()},0)}function w(){var t,i=m(),o=i.width,r=i.no,u=[];for(t=0;r>t;t++)u.push(0);a(G).forEach(function(n){var t=s(n);a(t.find("img")).forEach(function(n){var i=e(n);if(i.hasClass("img-loaded"))return void i.css("height","");t.addClass("ag-no-transition"),t.css("width",o+"px");var a=i.attr("actual-width")||i.attr("data-actual-width"),r=i.attr("actual-height")||i.attr("data-actual-height");a&&r&&i.css("height",r*n.width/a+"px")}),t.removeClass("ag-no-transition")});var c=G.clone();c.addClass("ag-no-transition");var l=n.extend({},d);l.width=o+"px",c.css(l),g.append(c),v(c,{ignoreCheck:function(n){return!s(n).hasClass("img-loaded")},onFullLoad:function(){var n,t,i,a=[];for(t=0,i=c.length;i>t;t++)a.push(c[t].offsetHeight);for(t=0,i=G.length;i>t;t++){n=s(G[t]);var r=a[t],e=Math.min.apply(Math,u),d=u.indexOf(e);u[d]=e+r+M.gutterSize;var l=d*(o+M.gutterSize),f={position:"absolute",top:e+"px"};"rtol"==M.direction?f.right=l+"px":f.left=l+"px",f.width=o+"px",n.css(f).addClass("angular-grid-item")}g.css("height",Math.max.apply(Math,u)+"px"),c.remove()}})}function C(){var n=!1;a(G).forEach(function(i){var o=e(i),a=o.find("img");a.length&&(o.addClass("img-loading"),v(o,{beforeLoad:function(n){s(n).addClass("img-loading")},isLoaded:function(n){s(n).removeClass("img-loading").addClass("img-loaded")},onLoad:function(i){!n&&M.refreshOnImgLoad&&(n=!0,t(function(){w(),n=!1},100)),s(i).removeClass("img-loading").addClass("img-loaded")},onFullLoad:function(){o.removeClass("img-loading").addClass("img-loaded")}}))})}function y(){var n=a(G).filter(function(n){return s(n).hasClass("ng-leave")});return c(function(i){n.length?s(n[0]).one("webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",function(){t(function(){G=g.children(),i()})}):i()})}function x(){t(function(){G=g.children(),y().then(function(){C(),t(function(){w()})})})}function L(){p(),G&&w()}function z(){var n=S.offsetWidth;$!=n&&($=n,E&&t.cancel(E),E=t(function(){w()},100))}var G,E,S=g[0],W=e(u),b=h.angularGridId;g.addClass("angular-grid");var M;p(),f.$watch("model",x,!0),f.$watch("options",L,!0),Object.keys(r).forEach(function(n){f[n]!=i&&f.$watch(n,L)});var $=S.offsetWidth;W.on("resize",z),b&&(l[b]={refresh:function(){x()}}),f.$on("$destroy",function(){b&&delete l[b],W.off("resize",z)})}}}]).factory("angularGridInstance",function(){var n={};return n})}(angular,window);